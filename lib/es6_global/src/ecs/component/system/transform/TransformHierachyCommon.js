// Generated by BUCKLESCRIPT VERSION 2.1.0, PLEASE EDIT WITH CARE
'use strict';

import * as Js_primitive                    from "../../../../../../../node_modules/bs-platform/lib/es6/js_primitive.js";
import * as Log$WonderLog                   from "../../../../../../../node_modules/wonder-log/lib/es6_global/src/Log.js";
import * as Contract$WonderLog              from "../../../../../../../node_modules/wonder-log/lib/es6_global/src/Contract.js";
import * as StateData$Wonderjs              from "../../../../core/StateData.js";
import * as ArraySystem$Wonderjs            from "../../../../structure/ArraySystem.js";
import * as TransformJudgeCommon$Wonderjs   from "./TransformJudgeCommon.js";
import * as SparseMapSystem$WonderCommonlib from "../../../../../../../node_modules/wonder-commonlib/lib/es6_global/src/SparseMapSystem.js";

function _unsafeGetParent(index, transformData) {
  return SparseMapSystem$WonderCommonlib.unsafeGet(index, transformData[/* parentMap */1]);
}

function getParent(index, transformData) {
  return Js_primitive.undefined_to_opt(SparseMapSystem$WonderCommonlib.unsafeGet(index, transformData[/* parentMap */1]));
}

function removeFromParentMap(childIndex, transformData) {
  SparseMapSystem$WonderCommonlib.deleteVal(childIndex, transformData[/* parentMap */1]);
  return transformData;
}

function unsafeGetChildren(index, transformData) {
  return Contract$WonderLog.ensureCheck((function (children) {
                return Contract$WonderLog.test(Log$WonderLog.buildAssertMessage("children exist", "not"), (function () {
                              return Contract$WonderLog.assertNullableExist(children);
                            }));
              }), StateData$Wonderjs.stateData[/* isDebug */1], SparseMapSystem$WonderCommonlib.unsafeGet(index, transformData[/* childMap */2]));
}

function _removeChild(childIndex, children) {
  return ArraySystem$Wonderjs.deleteBySwap(children.indexOf(childIndex), children.length - 1 | 0, children);
}

function removeFromChildMap(parentIndex, childIndex, transformData) {
  _removeChild(childIndex, unsafeGetChildren(parentIndex, transformData));
  return transformData;
}

function _removeFromParent(currentParentIndex, child, transformData) {
  return removeFromChildMap(currentParentIndex, child, removeFromParentMap(child, transformData));
}

function _setParent(parent, childIndex, transformData) {
  SparseMapSystem$WonderCommonlib.set(childIndex, parent, transformData[/* parentMap */1]);
  return transformData;
}

function _addChild(parentIndex, child, transformData) {
  unsafeGetChildren(parentIndex, transformData).push(child);
  return transformData;
}

function _addToParent(parent, child, transformData) {
  Contract$WonderLog.requireCheck((function () {
          Contract$WonderLog.test(Log$WonderLog.buildAssertMessage("child not has parent", "has"), (function () {
                  return Contract$WonderLog.assertNotExist(getParent(child, transformData));
                }));
          return Contract$WonderLog.test(Log$WonderLog.buildAssertMessage("parent not already has the child", "has"), (function () {
                        return Contract$WonderLog.assertFalse(+unsafeGetChildren(parent, transformData).includes(child));
                      }));
        }), StateData$Wonderjs.stateData[/* isDebug */1]);
  return _addChild(parent, child, _setParent(parent, child, transformData));
}

function _setNewParent(parent, child, transformData) {
  var match = getParent(child, transformData);
  if (match) {
    var currentParent = match[0];
    var match$1 = 1 - TransformJudgeCommon$Wonderjs.isSame(currentParent, parent);
    if (match$1 !== 0) {
      return _addToParent(parent, child, _removeFromParent(currentParent, child, transformData));
    } else {
      return transformData;
    }
  } else {
    return _addToParent(parent, child, transformData);
  }
}

function setParent(parent, child, transformData) {
  if (parent) {
    return _setNewParent(parent[0], child, transformData);
  } else {
    var match = getParent(child, transformData);
    if (match) {
      return _removeFromParent(match[0], child, transformData);
    } else {
      return transformData;
    }
  }
}

export {
  _unsafeGetParent    ,
  getParent           ,
  removeFromParentMap ,
  unsafeGetChildren   ,
  _removeChild        ,
  removeFromChildMap  ,
  _removeFromParent   ,
  _setParent          ,
  _addChild           ,
  _addToParent        ,
  _setNewParent       ,
  setParent           ,
  
}
/* Log-WonderLog Not a pure module */
