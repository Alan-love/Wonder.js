// Generated by BUCKLESCRIPT VERSION 2.1.0, PLEASE EDIT WITH CARE
'use strict';

import * as MostUtils$Wonderjs                                       from "../../../../asset/utils/MostUtils.js";
import * as MessageService$Wonderjs                                  from "../../../../service/primitive/worker/MessageService.js";
import * as DeviceManagerService$Wonderjs                            from "../../../../service/record/all/device/DeviceManagerService.js";
import * as StateRenderWorkerService$Wonderjs                        from "../../../../service/state/render_worker/state/StateRenderWorkerService.js";
import * as InitInitBasicMaterialService$Wonderjs                    from "../../../../service/state/init_material/init_basicMaterial/material/basic/InitInitBasicMaterialService.js";
import * as JudgeInstanceRenderWorkerService$Wonderjs                from "../../../../service/state/render_worker/instance/JudgeInstanceRenderWorkerService.js";
import * as CreateTypeArrayBasicMaterialService$Wonderjs             from "../../../../service/record/all/material/basic/CreateTypeArrayBasicMaterialService.js";
import * as RecordBasicMaterialRenderWorkerService$Wonderjs          from "../../../../service/state/render_worker/material/basic/RecordBasicMaterialRenderWorkerService.js";
import * as CreateInitBasicMaterialStateRenderWorkerService$Wonderjs from "../../../../service/state/render_worker/material/basic/CreateInitBasicMaterialStateRenderWorkerService.js";

function _createTypeArrays(count, state) {
  var basicMaterialRecord = RecordBasicMaterialRenderWorkerService$Wonderjs.getRecord(state);
  var match = CreateTypeArrayBasicMaterialService$Wonderjs.createTypeArrays(basicMaterialRecord[/* buffer */0], count);
  state[/* basicMaterialRecord */11] = /* Some */[/* record */[
      /* buffer */basicMaterialRecord[/* buffer */0],
      /* shaderIndices : Some */[match[0]],
      /* colors : Some */[match[1]],
      /* index */basicMaterialRecord[/* index */3],
      /* disposedIndexArray */basicMaterialRecord[/* disposedIndexArray */4],
      /* isSourceInstanceMap */basicMaterialRecord[/* isSourceInstanceMap */5]
    ]];
  return state;
}

function _initMaterials(_, _$1, state) {
  var match = RecordBasicMaterialRenderWorkerService$Wonderjs.getRecord(state);
  InitInitBasicMaterialService$Wonderjs.init(DeviceManagerService$Wonderjs.unsafeGetGl(state[/* deviceManagerRecord */3]), /* tuple */[
        match[/* isSourceInstanceMap */5],
        JudgeInstanceRenderWorkerService$Wonderjs.isSupportInstance(state)
      ], CreateInitBasicMaterialStateRenderWorkerService$Wonderjs.createInitMaterialState(state));
  return state;
}

function execJob(_, e, stateData) {
  return MostUtils$Wonderjs.callFunc((function () {
                var state = StateRenderWorkerService$Wonderjs.unsafeGetState(stateData);
                var data = MessageService$Wonderjs.getRecord(e);
                var basicMaterialData = data.basicMaterialData;
                var count = data.bufferData.basicMaterialDataBufferCount;
                StateRenderWorkerService$Wonderjs.setState(stateData, _initMaterials(basicMaterialData, data, _createTypeArrays(count, state)));
                return e;
              }));
}

export {
  _createTypeArrays ,
  _initMaterials    ,
  execJob           ,
  
}
/* MostUtils-Wonderjs Not a pure module */
