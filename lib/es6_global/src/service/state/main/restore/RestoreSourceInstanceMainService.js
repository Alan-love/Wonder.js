// Generated by BUCKLESCRIPT VERSION 2.1.0, PLEASE EDIT WITH CARE
'use strict';

import * as SparseMapService$Wonderjs                from "../../../atom/SparseMapService.js";
import * as MemorySettingService$Wonderjs            from "../../../record/main/setting/MemorySettingService.js";
import * as TypeArrayPoolService$Wonderjs            from "../../../record/main/typeArrayPool/TypeArrayPoolService.js";
import * as CopyArrayBufferService$Wonderjs          from "../../../primitive/copy/CopyArrayBufferService.js";
import * as SparseMapService$WonderCommonlib         from "../../../../../../../node_modules/wonder-commonlib/lib/es6_global/src/SparseMapService.js";
import * as RecordSourceInstanceMainService$Wonderjs from "../instance/RecordSourceInstanceMainService.js";

function _buildIsNotSendTransformMatrixDataMap(isSendTransformMatrixDataMap) {
  return SparseMapService$Wonderjs.reduceiValid((function (newMap, _, index) {
                return SparseMapService$WonderCommonlib.set(index, /* false */0, newMap);
              }), SparseMapService$WonderCommonlib.createEmpty(/* () */0), isSendTransformMatrixDataMap);
}

function restore(currentState, sharedData, targetState) {
  var currentSourceInstanceRecord = RecordSourceInstanceMainService$Wonderjs.getRecord(currentState);
  var targetSourceInstanceRecord = RecordSourceInstanceMainService$Wonderjs.getRecord(targetState);
  var newBuffer = CopyArrayBufferService$Wonderjs.copyArrayBufferData(targetSourceInstanceRecord[/* buffer */2], currentSourceInstanceRecord[/* buffer */2]);
  var float32ArrayPoolMap = TypeArrayPoolService$Wonderjs.addAllFloat32TypeArrayToPool(currentSourceInstanceRecord[/* matrixFloat32ArrayMap */6], MemorySettingService$Wonderjs.getMaxBigTypeArrayPoolSize(targetState[/* settingRecord */0]), sharedData[/* float32ArrayPoolMap */1]);
  var newrecord = targetState.slice();
  var newrecord$1 = targetSourceInstanceRecord.slice();
  newrecord[/* sourceInstanceRecord */6] = /* Some */[(newrecord$1[/* buffer */2] = newBuffer, newrecord$1[/* isSendTransformMatrixDataMap */7] = _buildIsNotSendTransformMatrixDataMap(targetSourceInstanceRecord[/* isSendTransformMatrixDataMap */7]), newrecord$1)];
  return /* tuple */[
          newrecord,
          /* record */[
            /* gl */sharedData[/* gl */0],
            /* float32ArrayPoolMap */float32ArrayPoolMap,
            /* uint16ArrayPoolMap */sharedData[/* uint16ArrayPoolMap */2]
          ]
        ];
}

export {
  _buildIsNotSendTransformMatrixDataMap ,
  restore                               ,
  
}
/* SparseMapService-Wonderjs Not a pure module */
