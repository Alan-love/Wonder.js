// Generated by BUCKLESCRIPT VERSION 2.1.0, PLEASE EDIT WITH CARE
'use strict';

import * as Contract$WonderLog                  from "../../../../../../../../node_modules/wonder-log/lib/es6_global/src/Contract.js";
import * as StateDataMain$Wonderjs              from "../../../../state/main/data/StateDataMain.js";
import * as IsDebugMainService$Wonderjs         from "../../../../state/main/state/IsDebugMainService.js";
import * as ArrayService$WonderCommonlib        from "../../../../../../../../node_modules/wonder-commonlib/lib/es6_global/src/ArrayService.js";
import * as DisposeMaterialService$Wonderjs     from "../DisposeMaterialService.js";
import * as DisposeComponentService$Wonderjs    from "../../../../primitive/component/DisposeComponentService.js";
import * as DisposeTypeArrayService$Wonderjs    from "../../../../primitive/buffer/DisposeTypeArrayService.js";
import * as GroupBasicMaterialService$Wonderjs  from "./GroupBasicMaterialService.js";
import * as BufferBasicMaterialService$Wonderjs from "./BufferBasicMaterialService.js";

function isAlive(material, param) {
  return DisposeComponentService$Wonderjs.isAlive(material, param[/* disposedIndexArray */8]);
}

function _disposeData(material, record) {
  var match = DisposeMaterialService$Wonderjs.disposeData(material, /* tuple */[
        record[/* shaderIndices */2],
        record[/* groupCountMap */7],
        record[/* gameObjectMap */6]
      ], record[/* defaultShaderIndex */4]);
  return /* record */[
          /* index */record[/* index */0],
          /* buffer */record[/* buffer */1],
          /* shaderIndices */match[0],
          /* colors */DisposeTypeArrayService$Wonderjs.deleteAndResetFloat32TypeArr(BufferBasicMaterialService$Wonderjs.getColorIndex(material), BufferBasicMaterialService$Wonderjs.getColorsSize(/* () */0), record[/* defaultColor */5], record[/* colors */3]),
          /* defaultShaderIndex */record[/* defaultShaderIndex */4],
          /* defaultColor */record[/* defaultColor */5],
          /* gameObjectMap */match[2],
          /* groupCountMap */match[1],
          /* disposedIndexArray */record[/* disposedIndexArray */8],
          /* materialArrayForWorkerInit */record[/* materialArrayForWorkerInit */9]
        ];
}

function _handleDispose(disposedIndexArray, material, record) {
  var match = GroupBasicMaterialService$Wonderjs.isGroupMaterial(material, record);
  if (match !== 0) {
    return GroupBasicMaterialService$Wonderjs.decreaseGroupCount(material, record);
  } else {
    var newrecord = _disposeData(material, record).slice();
    newrecord[/* disposedIndexArray */8] = DisposeMaterialService$Wonderjs.addDisposeIndex(material, disposedIndexArray);
    return newrecord;
  }
}

function handleBatchDisposeComponent(materialArray, record) {
  var disposedIndexArray = record[/* disposedIndexArray */8];
  Contract$WonderLog.requireCheck((function () {
          return DisposeComponentService$Wonderjs.checkComponentShouldAliveWithBatchDispose(materialArray, isAlive, record);
        }), IsDebugMainService$Wonderjs.getIsDebug(StateDataMain$Wonderjs.stateData));
  return ArrayService$WonderCommonlib.reduceOneParam((function (record, material) {
                return _handleDispose(disposedIndexArray, material, record);
              }), record, materialArray);
}

export {
  isAlive                     ,
  _disposeData                ,
  _handleDispose              ,
  handleBatchDisposeComponent ,
  
}
/* Contract-WonderLog Not a pure module */
