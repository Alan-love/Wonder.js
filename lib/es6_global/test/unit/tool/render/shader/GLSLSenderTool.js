// Generated by BUCKLESCRIPT VERSION 2.1.0, PLEASE EDIT WITH CARE
'use strict';

import * as Curry                         from "../../../../../../../node_modules/bs-platform/lib/es6/curry.js";
import * as Sinon                         from "../../../../../../../node_modules/wonder-bs-sinon/lib/es6_global/src/sinon.js";
import * as Wonder_jest                   from "../../../../../../../node_modules/wonder-bs-jest/lib/es6_global/src/wonder_jest.js";
import * as StateTool$Wonderjs            from "../../core/StateTool.js";
import * as FakeGlTool$Wonderjs           from "../../gl/FakeGlTool.js";
import * as GameObject$Wonderjs           from "../../../../../src/ecs/admin/api/GameObject.js";
import * as RenderJobsTool$Wonderjs       from "../core/render/jobs/RenderJobsTool.js";
import * as WebGLRenderTool$Wonderjs      from "../core/WebGLRenderTool.js";
import * as GLSLLocationTool$Wonderjs     from "./GLSLLocationTool.js";
import * as GLSLSenderSystem$Wonderjs     from "../../../../../src/renderer/shader/sender/GLSLSenderSystem.js";
import * as DeviceManagerSystem$Wonderjs  from "../../../../../src/renderer/device/DeviceManagerSystem.js";
import * as CameraControllerTool$Wonderjs from "../../component/cameraController/CameraControllerTool.js";
import * as GLSLSenderStateUtils$Wonderjs from "../../../../../src/renderer/shader/sender/utils/GLSLSenderStateUtils.js";

function disableVertexAttribArray(state) {
  return GLSLSenderSystem$Wonderjs.disableVertexAttribArray(DeviceManagerSystem$Wonderjs.getGl(state), state);
}

function cleanLastSendArrayBuffer(state) {
  GLSLSenderStateUtils$Wonderjs.getGLSLSenderData(state)[/* lastSendArrayBuffer */8] = /* None */0;
  return state;
}

var _render = WebGLRenderTool$Wonderjs.render;

function _prepareSendUinformData(sandbox, state) {
  var match = RenderJobsTool$Wonderjs.prepareGameObject(sandbox, state);
  var gameObject = match[1];
  var match$1 = CameraControllerTool$Wonderjs.createCameraGameObject(match[0]);
  var state$1 = match$1[0];
  return /* tuple */[
          state$1,
          gameObject,
          /* tuple */[
            GameObject$Wonderjs.getGameObjectTransformComponent(gameObject, state$1),
            match[3]
          ],
          match$1[2],
          match$1[3]
        ];
}

function testSendMatrix4(sandbox, name, setFunc, targetData, $staropt$star, _) {
  var testFunc = $staropt$star ? $staropt$star[0] : (function () {
        return /* () */0;
      });
  describe("send " + (String(name) + ""), (function () {
          var state = [StateTool$Wonderjs.createState(/* None */0, /* () */0)];
          beforeEach((function () {
                  state[0] = RenderJobsTool$Wonderjs.initWithRenderConfigWithoutBuildFakeDom(sandbox);
                  return /* () */0;
                }));
          Wonder_jest.test("test send", (function () {
                  var match = _prepareSendUinformData(sandbox, state[0]);
                  var state$1 = Curry._4(setFunc, match[2][0], match[3], match[4], match[0]);
                  var uniformMatrix4fv = Sinon.createEmptyStubWithJsObjSandbox(sandbox);
                  var getUniformLocation = GLSLLocationTool$Wonderjs.getUniformLocation(/* Some */[0], sandbox, name);
                  var state$2 = FakeGlTool$Wonderjs.setFakeGl(FakeGlTool$Wonderjs.buildFakeGl(sandbox, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* Some */[getUniformLocation], /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* Some */[uniformMatrix4fv], /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* () */0), state$1);
                  WebGLRenderTool$Wonderjs.render(RenderJobsTool$Wonderjs.updateSystem(RenderJobsTool$Wonderjs.initSystemAndRender(state$2)));
                  return Sinon.toCalledWith(/* :: */[
                              0,
                              /* :: */[
                                false,
                                /* :: */[
                                  targetData,
                                  /* [] */0
                                ]
                              ]
                            ], Wonder_jest.Expect[/* expect */0](uniformMatrix4fv));
                }));
          return Curry._1(testFunc, _prepareSendUinformData);
        }));
  return /* () */0;
}

function testSendVector3(sandbox, name, setFunc, targetData, $staropt$star, _) {
  var testFunc = $staropt$star ? $staropt$star[0] : (function () {
        return /* () */0;
      });
  describe("send " + (String(name) + ""), (function () {
          var state = [StateTool$Wonderjs.createState(/* None */0, /* () */0)];
          var _prepare = function (sandbox, state) {
            var match = _prepareSendUinformData(sandbox, state[0]);
            var match$1 = match[2];
            var state$1 = Curry._4(setFunc, /* tuple */[
                  match$1[0],
                  match$1[1]
                ], match[3], match[4], match[0]);
            var uniform3f = Sinon.createEmptyStubWithJsObjSandbox(sandbox);
            var getUniformLocation = GLSLLocationTool$Wonderjs.getUniformLocation(/* Some */[0], sandbox, name);
            var state$2 = FakeGlTool$Wonderjs.setFakeGl(FakeGlTool$Wonderjs.buildFakeGl(sandbox, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* Some */[getUniformLocation], /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* Some */[uniform3f], /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* () */0), state$1);
            var state$3 = WebGLRenderTool$Wonderjs.render(RenderJobsTool$Wonderjs.updateSystem(RenderJobsTool$Wonderjs.initSystemAndRender(state$2)));
            return /* tuple */[
                    state$3,
                    0,
                    uniform3f
                  ];
          };
          beforeEach((function () {
                  state[0] = RenderJobsTool$Wonderjs.initWithRenderConfigWithoutBuildFakeDom(sandbox);
                  return /* () */0;
                }));
          Wonder_jest.test("if cached, not send", (function () {
                  var match = _prepare(sandbox, state);
                  WebGLRenderTool$Wonderjs.render(match[0]);
                  return Curry._2(Wonder_jest.Expect[/* Operators */23][/* = */5], Wonder_jest.Expect[/* expect */0](Sinon.getCallCount(Sinon.withOneArg(match[1], match[2]))), 1);
                }));
          Wonder_jest.test("test send", (function () {
                  var match = _prepare(sandbox, state);
                  return Curry._2(Wonder_jest.Expect[/* Operators */23][/* = */5], Wonder_jest.Expect[/* expect */0](Sinon.getArgs(Sinon.getCall(0, match[2]))), /* :: */[
                              match[1],
                              targetData
                            ]);
                }));
          return Curry._1(testFunc, _prepareSendUinformData);
        }));
  return /* () */0;
}

var JudgeSendUniformData = /* module */[
  /* _render */_render,
  /* _prepareSendUinformData */_prepareSendUinformData,
  /* testSendMatrix4 */testSendMatrix4,
  /* testSendVector3 */testSendVector3
];

var getGLSLSenderData = GLSLSenderSystem$Wonderjs.getGLSLSenderData;

export {
  getGLSLSenderData        ,
  disableVertexAttribArray ,
  cleanLastSendArrayBuffer ,
  JudgeSendUniformData     ,
  
}
/* Sinon Not a pure module */
