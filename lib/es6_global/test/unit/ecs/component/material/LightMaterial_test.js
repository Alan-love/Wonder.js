// Generated by BUCKLESCRIPT VERSION 2.1.0, PLEASE EDIT WITH CARE
'use strict';

import * as Curry                            from "../../../../../../../node_modules/bs-platform/lib/es6/curry.js";
import * as Sinon                            from "../../../../../../../node_modules/wonder-bs-sinon/lib/es6_global/src/sinon.js";
import * as Sinon$1                          from "sinon";
import * as Wonder_jest                      from "../../../../../../../node_modules/wonder-bs-jest/lib/es6_global/src/wonder_jest.js";
import * as TestTool$Wonderjs                from "../../../../tool/TestTool.js";
import * as SettingTool$Wonderjs             from "../../../../tool/service/setting/SettingTool.js";
import * as GameObjectAPI$Wonderjs           from "../../../../../src/api/GameObjectAPI.js";
import * as MainStateTool$Wonderjs           from "../../../../tool/service/state/MainStateTool.js";
import * as TypeArrayTool$Wonderjs           from "../../../../tool/service/primitive/TypeArrayTool.js";
import * as GameObjectTool$Wonderjs          from "../../../../tool/service/gameObject/GameObjectTool.js";
import * as AllMaterialTool$Wonderjs         from "../../../../tool/service/material/AllMaterialTool.js";
import * as LightMaterialAPI$Wonderjs        from "../../../../../src/api/material/LightMaterialAPI.js";
import * as LightMaterialTool$Wonderjs       from "../../../../tool/service/material/LightMaterialTool.js";
import * as BasicSourceTextureAPI$Wonderjs   from "../../../../../src/api/texture/BasicSourceTextureAPI.js";
import * as BasicSourceTextureTool$Wonderjs  from "../../../../tool/service/texture/BasicSourceTextureTool.js";
import * as SparseMapService$WonderCommonlib from "../../../../../../../node_modules/wonder-commonlib/lib/es6_global/src/SparseMapService.js";

describe("LightMaterial", (function () {
        var sandbox = Sinon.getSandboxDefaultVal(/* () */0);
        var state = [MainStateTool$Wonderjs.createState(/* () */0)];
        beforeEach((function () {
                sandbox[0] = Sinon$1.sandbox.create();
                state[0] = TestTool$Wonderjs.init(sandbox, /* None */0, /* None */0, /* () */0);
                return /* () */0;
              }));
        afterEach((function () {
                return Curry._1(Sinon.restoreSandbox, sandbox[0]);
              }));
        describe("createLightMaterial", (function () {
                Wonder_jest.test("create a new material which is just index(int)", (function () {
                        var match = LightMaterialAPI$Wonderjs.createLightMaterial(state[0]);
                        return Curry._2(Wonder_jest.Expect[/* Operators */23][/* = */5], Wonder_jest.Expect[/* expect */0](match[1]), 0);
                      }));
                describe("set default value", (function () {
                        return Wonder_jest.test("set texture count to be 0", (function () {
                                      var match = LightMaterialAPI$Wonderjs.createLightMaterial(state[0]);
                                      return Curry._2(Wonder_jest.Expect[/* Operators */23][/* = */5], Wonder_jest.Expect[/* expect */0](LightMaterialTool$Wonderjs.getBasicSourceTextureCount(match[1], match[0])), 0);
                                    }));
                      }));
                return /* () */0;
              }));
        describe("unsafeGetLightMaterialGameObject", (function () {
                return Wonder_jest.test("get material's gameObject", (function () {
                              var match = LightMaterialAPI$Wonderjs.createLightMaterial(state[0]);
                              var material = match[1];
                              var match$1 = GameObjectAPI$Wonderjs.createGameObject(match[0]);
                              var gameObject = match$1[1];
                              var state$1 = GameObjectAPI$Wonderjs.addGameObjectLightMaterialComponent(gameObject, material, match$1[0]);
                              return Curry._2(Wonder_jest.Expect[/* Operators */23][/* = */5], Wonder_jest.Expect[/* expect */0](LightMaterialAPI$Wonderjs.unsafeGetLightMaterialGameObject(material, state$1)), gameObject);
                            }));
              }));
        describe("operate data", (function () {
                Wonder_jest.test("get the data from array buffer may not equal to the value which is setted", (function () {
                        var match = LightMaterialAPI$Wonderjs.createLightMaterial(state[0]);
                        var material = match[1];
                        var color = /* float array */[
                          0.2,
                          0.3,
                          0.5
                        ];
                        var state$1 = LightMaterialAPI$Wonderjs.setLightMaterialDiffuseColor(material, color, match[0]);
                        return Curry._2(Wonder_jest.Expect[/* Operators */23][/* = */5], Wonder_jest.Expect[/* expect */0](LightMaterialAPI$Wonderjs.getLightMaterialDiffuseColor(material, state$1)), /* float array */[
                                    0.20000000298023224,
                                    0.30000001192092896,
                                    0.5
                                  ]);
                      }));
                describe("getLightMaterialDiffuseColor", (function () {
                        return Wonder_jest.test("test default color", (function () {
                                      var match = LightMaterialAPI$Wonderjs.createLightMaterial(state[0]);
                                      return Curry._2(Wonder_jest.Expect[/* Operators */23][/* = */5], Wonder_jest.Expect[/* expect */0](LightMaterialAPI$Wonderjs.getLightMaterialDiffuseColor(match[1], match[0])), /* float array */[
                                                  1,
                                                  1,
                                                  1
                                                ]);
                                    }));
                      }));
                describe("setLightMaterialDiffuseColor", (function () {
                        return Wonder_jest.test("test set color", (function () {
                                      var match = LightMaterialAPI$Wonderjs.createLightMaterial(state[0]);
                                      var material = match[1];
                                      var color = /* float array */[
                                        0.2,
                                        0.3,
                                        0.5
                                      ];
                                      var state$1 = LightMaterialAPI$Wonderjs.setLightMaterialDiffuseColor(material, color, match[0]);
                                      return Curry._2(Wonder_jest.Expect[/* Operators */23][/* = */5], Wonder_jest.Expect[/* expect */0](TypeArrayTool$Wonderjs.truncateArray(LightMaterialAPI$Wonderjs.getLightMaterialDiffuseColor(material, state$1))), color);
                                    }));
                      }));
                describe("getLightMaterialSpecularColor", (function () {
                        return Wonder_jest.test("test default color", (function () {
                                      var match = LightMaterialAPI$Wonderjs.createLightMaterial(state[0]);
                                      return Curry._2(Wonder_jest.Expect[/* Operators */23][/* = */5], Wonder_jest.Expect[/* expect */0](LightMaterialAPI$Wonderjs.getLightMaterialSpecularColor(match[1], match[0])), /* float array */[
                                                  1,
                                                  1,
                                                  1
                                                ]);
                                    }));
                      }));
                describe("setLightMaterialSpecularColor", (function () {
                        return Wonder_jest.test("test set color", (function () {
                                      var match = LightMaterialAPI$Wonderjs.createLightMaterial(state[0]);
                                      var material = match[1];
                                      var color = /* float array */[
                                        0.2,
                                        0.3,
                                        0.5
                                      ];
                                      var state$1 = LightMaterialAPI$Wonderjs.setLightMaterialSpecularColor(material, color, match[0]);
                                      return Curry._2(Wonder_jest.Expect[/* Operators */23][/* = */5], Wonder_jest.Expect[/* expect */0](TypeArrayTool$Wonderjs.truncateArray(LightMaterialAPI$Wonderjs.getLightMaterialSpecularColor(material, state$1))), color);
                                    }));
                      }));
                describe("getLightMaterialShininess", (function () {
                        return Wonder_jest.test("test default shininess", (function () {
                                      var match = LightMaterialAPI$Wonderjs.createLightMaterial(state[0]);
                                      return Curry._2(Wonder_jest.Expect[/* Operators */23][/* = */5], Wonder_jest.Expect[/* expect */0](LightMaterialAPI$Wonderjs.getLightMaterialShininess(match[1], match[0])), 32);
                                    }));
                      }));
                describe("setLightMaterialShininess", (function () {
                        return Wonder_jest.test("test set shininess", (function () {
                                      var match = LightMaterialAPI$Wonderjs.createLightMaterial(state[0]);
                                      var material = match[1];
                                      var state$1 = LightMaterialAPI$Wonderjs.setLightMaterialShininess(material, 30, match[0]);
                                      return Curry._2(Wonder_jest.Expect[/* Operators */23][/* = */5], Wonder_jest.Expect[/* expect */0](LightMaterialAPI$Wonderjs.getLightMaterialShininess(material, state$1)), 30);
                                    }));
                      }));
                describe("unsafeGetLightMaterialDiffuseMap", (function () {
                        return Wonder_jest.test("if has no map, error", (function () {
                                      var match = LightMaterialAPI$Wonderjs.createLightMaterial(state[0]);
                                      var material = match[1];
                                      var state$1 = match[0];
                                      return Wonder_jest.Expect[/* toThrowMessage */20]("expect data exist", Wonder_jest.Expect[/* expect */0]((function () {
                                                        return LightMaterialAPI$Wonderjs.unsafeGetLightMaterialDiffuseMap(material, state$1);
                                                      })));
                                    }));
                      }));
                describe("unsafeGetLightMaterialSpecularMap", (function () {
                        return Wonder_jest.test("if has no map, error", (function () {
                                      var match = LightMaterialAPI$Wonderjs.createLightMaterial(state[0]);
                                      var material = match[1];
                                      var state$1 = match[0];
                                      return Wonder_jest.Expect[/* toThrowMessage */20]("expect data exist", Wonder_jest.Expect[/* expect */0]((function () {
                                                        return LightMaterialAPI$Wonderjs.unsafeGetLightMaterialSpecularMap(material, state$1);
                                                      })));
                                    }));
                      }));
                describe("setLightMaterialDiffuseMap, setLightMaterialSpecularMap", (function () {
                        var _prepare = function (state) {
                          var match = LightMaterialAPI$Wonderjs.createLightMaterial(state);
                          var material = match[1];
                          var match$1 = BasicSourceTextureAPI$Wonderjs.createBasicSourceTexture(match[0]);
                          var map1 = match$1[1];
                          var match$2 = BasicSourceTextureAPI$Wonderjs.createBasicSourceTexture(match$1[0]);
                          var map2 = match$2[1];
                          var state$1 = LightMaterialAPI$Wonderjs.setLightMaterialSpecularMap(material, map1, match$2[0]);
                          var state$2 = LightMaterialAPI$Wonderjs.setLightMaterialDiffuseMap(material, map2, state$1);
                          return /* tuple */[
                                  state$2,
                                  material,
                                  /* tuple */[
                                    map1,
                                    map2
                                  ]
                                ];
                        };
                        Wonder_jest.test("texture count + 1", (function () {
                                var match = _prepare(state[0]);
                                return Curry._2(Wonder_jest.Expect[/* Operators */23][/* = */5], Wonder_jest.Expect[/* expect */0](LightMaterialTool$Wonderjs.getBasicSourceTextureCount(match[1], match[0])), 2);
                              }));
                        Wonder_jest.test("set map unit", (function () {
                                var match = _prepare(state[0]);
                                var material = match[1];
                                var state$1 = match[0];
                                return Curry._2(Wonder_jest.Expect[/* Operators */23][/* = */5], Wonder_jest.Expect[/* expect */0](/* tuple */[
                                                LightMaterialAPI$Wonderjs.unsafeGetLightMaterialDiffuseMap(material, state$1),
                                                LightMaterialAPI$Wonderjs.unsafeGetLightMaterialSpecularMap(material, state$1)
                                              ]), /* tuple */[
                                            1,
                                            0
                                          ]);
                              }));
                        return Wonder_jest.test("save texture index", (function () {
                                      var match = _prepare(state[0]);
                                      var match$1 = match[2];
                                      var material = match[1];
                                      var state$1 = match[0];
                                      return Curry._2(Wonder_jest.Expect[/* Operators */23][/* = */5], Wonder_jest.Expect[/* expect */0](/* tuple */[
                                                      LightMaterialAPI$Wonderjs.unsafeGetLightMaterialDiffuseMap(material, state$1),
                                                      LightMaterialAPI$Wonderjs.unsafeGetLightMaterialSpecularMap(material, state$1)
                                                    ]), /* tuple */[
                                                  match$1[1],
                                                  match$1[0]
                                                ]);
                                    }));
                      }));
                return /* () */0;
              }));
        describe("disposeComponent", (function () {
                describe("dispose data", (function () {
                        Wonder_jest.test("reset basicSourceTextureCount to 0 from textureCountMap", (function () {
                                var match = LightMaterialTool$Wonderjs.createGameObjectWithMap(state[0]);
                                var material1 = match[2][0];
                                var state$1 = GameObjectTool$Wonderjs.disposeGameObjectLightMaterialComponent(match[1], material1, match[0]);
                                return Curry._2(Wonder_jest.Expect[/* Operators */23][/* = */5], Wonder_jest.Expect[/* expect */0](LightMaterialTool$Wonderjs.getBasicSourceTextureCount(material1, state$1)), 0);
                              }));
                        Wonder_jest.test("remove from gameObjectMap", (function () {
                                var match = LightMaterialTool$Wonderjs.createGameObject(state[0]);
                                var material1 = match[2];
                                var state$1 = GameObjectTool$Wonderjs.disposeGameObjectLightMaterialComponent(match[1], material1, match[0]);
                                var match$1 = LightMaterialTool$Wonderjs.getRecord(state$1);
                                return Curry._2(Wonder_jest.Expect[/* Operators */23][/* = */5], Wonder_jest.Expect[/* expect */0](SparseMapService$WonderCommonlib.has(material1, match$1[/* gameObjectMap */13])), /* false */0);
                              }));
                        describe("test remove from type array", (function () {
                                var _testRemoveFromTypeArr = function (state, valueTuple, defaultValue, param) {
                                  return AllMaterialTool$Wonderjs.testRemoveFromTypeArr(state, valueTuple, defaultValue, /* tuple */[
                                              GameObjectTool$Wonderjs.disposeGameObjectLightMaterialComponent,
                                              param[0],
                                              param[1],
                                              param[2]
                                            ]);
                                };
                                describe("remove from shaderIndices", (function () {
                                        return Wonder_jest.test("reset removed one's value", (function () {
                                                      return _testRemoveFromTypeArr(state, /* tuple */[
                                                                  1,
                                                                  2
                                                                ], LightMaterialTool$Wonderjs.getDefaultShaderIndex(state[0]), /* tuple */[
                                                                  LightMaterialTool$Wonderjs.createGameObject,
                                                                  LightMaterialTool$Wonderjs.getShaderIndex,
                                                                  LightMaterialTool$Wonderjs.setShaderIndex
                                                                ]);
                                                    }));
                                      }));
                                describe("remove from diffuseColors", (function () {
                                        return Wonder_jest.test("reset removed one's value", (function () {
                                                      return _testRemoveFromTypeArr(state, /* tuple */[
                                                                  /* float array */[
                                                                    1,
                                                                    0.2,
                                                                    0.3
                                                                  ],
                                                                  /* float array */[
                                                                    0,
                                                                    0.2,
                                                                    0.3
                                                                  ]
                                                                ], LightMaterialTool$Wonderjs.getDefaultDiffuseColor(state[0]), /* tuple */[
                                                                  LightMaterialTool$Wonderjs.createGameObject,
                                                                  (function (material, state) {
                                                                      return TypeArrayTool$Wonderjs.truncateArray(LightMaterialAPI$Wonderjs.getLightMaterialDiffuseColor(material, state));
                                                                    }),
                                                                  LightMaterialAPI$Wonderjs.setLightMaterialDiffuseColor
                                                                ]);
                                                    }));
                                      }));
                                describe("remove from specularColors", (function () {
                                        return Wonder_jest.test("reset removed one's value", (function () {
                                                      return _testRemoveFromTypeArr(state, /* tuple */[
                                                                  /* float array */[
                                                                    1,
                                                                    0.2,
                                                                    0.3
                                                                  ],
                                                                  /* float array */[
                                                                    0,
                                                                    0.2,
                                                                    0.3
                                                                  ]
                                                                ], LightMaterialTool$Wonderjs.getDefaultSpecularColor(state[0]), /* tuple */[
                                                                  LightMaterialTool$Wonderjs.createGameObject,
                                                                  (function (material, state) {
                                                                      return TypeArrayTool$Wonderjs.truncateArray(LightMaterialAPI$Wonderjs.getLightMaterialSpecularColor(material, state));
                                                                    }),
                                                                  LightMaterialAPI$Wonderjs.setLightMaterialSpecularColor
                                                                ]);
                                                    }));
                                      }));
                                describe("remove from shininess", (function () {
                                        return Wonder_jest.test("reset removed one's value", (function () {
                                                      return _testRemoveFromTypeArr(state, /* tuple */[
                                                                  1,
                                                                  2
                                                                ], LightMaterialTool$Wonderjs.getDefaultShininess(state[0]), /* tuple */[
                                                                  LightMaterialTool$Wonderjs.createGameObject,
                                                                  LightMaterialAPI$Wonderjs.getLightMaterialShininess,
                                                                  LightMaterialAPI$Wonderjs.setLightMaterialShininess
                                                                ]);
                                                    }));
                                      }));
                                describe("test map typeArrays", (function () {
                                        var _testRemoveFromTypeArr = function (state, valueTuple, defaultValue, param) {
                                          return AllMaterialTool$Wonderjs.testRemoveFromTypeArrWithMap(state, valueTuple, defaultValue, /* tuple */[
                                                      GameObjectTool$Wonderjs.disposeGameObjectLightMaterialComponent,
                                                      param[0],
                                                      param[1],
                                                      param[2]
                                                    ]);
                                        };
                                        describe("remove from textureIndices", (function () {
                                                return Wonder_jest.test("reset material's all texture indices", (function () {
                                                              var state = TestTool$Wonderjs.initWithoutBuildFakeDom(sandbox, /* None */0, /* Some */[SettingTool$Wonderjs.buildBufferConfigStr(/* None */0, /* None */0, /* None */0, /* None */0, /* None */0, /* Some */[2], /* None */0, /* None */0, /* None */0, /* None */0, /* () */0)], /* () */0);
                                                              var match = LightMaterialTool$Wonderjs.createGameObjectWithMap(state);
                                                              var material1 = match[2][0];
                                                              var state$1 = match[0];
                                                              var match$1 = LightMaterialTool$Wonderjs.getRecord(state$1);
                                                              var textureIndices = match$1[/* textureIndices */6];
                                                              var sourceIndex = LightMaterialTool$Wonderjs.getTextureIndicesIndex(material1, state$1);
                                                              textureIndices[sourceIndex] = 1;
                                                              textureIndices[sourceIndex + 1 | 0] = 2;
                                                              textureIndices[sourceIndex + 2 | 0] = 3;
                                                              var defaultTextureIndex = LightMaterialTool$Wonderjs.getDefaultTextureIndex(/* () */0);
                                                              GameObjectTool$Wonderjs.disposeGameObjectLightMaterialComponent(match[1], material1, state$1);
                                                              return Curry._2(Wonder_jest.Expect[/* Operators */23][/* = */5], Wonder_jest.Expect[/* expect */0](textureIndices.slice(0, 5)), new Uint32Array(/* int array */[
                                                                              defaultTextureIndex,
                                                                              defaultTextureIndex,
                                                                              3,
                                                                              0,
                                                                              0
                                                                            ]));
                                                            }));
                                              }));
                                        describe("remove from diffuseMapUnits", (function () {
                                                return Wonder_jest.test("reset removed one's value", (function () {
                                                              return _testRemoveFromTypeArr(state, /* tuple */[
                                                                          1,
                                                                          2
                                                                        ], BasicSourceTextureTool$Wonderjs.getDefaultUnit(/* () */0), /* tuple */[
                                                                          LightMaterialTool$Wonderjs.createGameObjectWithMap,
                                                                          LightMaterialTool$Wonderjs.getDiffuseMapUnit,
                                                                          LightMaterialTool$Wonderjs.setDiffuseMapUnit
                                                                        ]);
                                                            }));
                                              }));
                                        describe("remove from specularMapUnits", (function () {
                                                return Wonder_jest.test("reset removed one's value", (function () {
                                                              return _testRemoveFromTypeArr(state, /* tuple */[
                                                                          1,
                                                                          2
                                                                        ], BasicSourceTextureTool$Wonderjs.getDefaultUnit(/* () */0), /* tuple */[
                                                                          LightMaterialTool$Wonderjs.createGameObjectWithMap,
                                                                          LightMaterialTool$Wonderjs.getSpecularMapUnit,
                                                                          LightMaterialTool$Wonderjs.setSpecularMapUnit
                                                                        ]);
                                                            }));
                                              }));
                                        return /* () */0;
                                      }));
                                return /* () */0;
                              }));
                        return Wonder_jest.test("reset group count", (function () {
                                      var match = LightMaterialAPI$Wonderjs.createLightMaterial(state[0]);
                                      var material1 = match[1];
                                      var match$1 = GameObjectAPI$Wonderjs.createGameObject(match[0]);
                                      var gameObject1 = match$1[1];
                                      var state$1 = GameObjectAPI$Wonderjs.addGameObjectLightMaterialComponent(gameObject1, material1, match$1[0]);
                                      var match$2 = GameObjectAPI$Wonderjs.createGameObject(state$1);
                                      var state$2 = GameObjectAPI$Wonderjs.addGameObjectLightMaterialComponent(match$2[1], material1, match$2[0]);
                                      var state$3 = GameObjectTool$Wonderjs.disposeGameObjectLightMaterialComponent(gameObject1, material1, state$2);
                                      return Curry._2(Wonder_jest.Expect[/* Operators */23][/* = */5], Wonder_jest.Expect[/* expect */0](LightMaterialTool$Wonderjs.getGroupCount(material1, state$3)), 0);
                                    }));
                      }));
                return /* () */0;
              }));
        describe("contract check: is alive", (function () {
                describe("if material is disposed", (function () {
                        var _testGetFunc = function (getFunc) {
                          var match = LightMaterialAPI$Wonderjs.createLightMaterial(state[0]);
                          var material = match[1];
                          var match$1 = GameObjectAPI$Wonderjs.createGameObject(match[0]);
                          var gameObject = match$1[1];
                          var state$1 = GameObjectAPI$Wonderjs.addGameObjectLightMaterialComponent(gameObject, material, match$1[0]);
                          var state$2 = GameObjectTool$Wonderjs.disposeGameObjectLightMaterialComponent(gameObject, material, state$1);
                          return Wonder_jest.Expect[/* toThrowMessage */20]("expect component alive, but actual not", Wonder_jest.Expect[/* expect */0]((function () {
                                            return Curry._2(getFunc, material, state$2);
                                          })));
                        };
                        Wonder_jest.test("unsafeGetLightMaterialGameObject should error", (function () {
                                return _testGetFunc(LightMaterialAPI$Wonderjs.unsafeGetLightMaterialGameObject);
                              }));
                        Wonder_jest.test("getLightMaterialDiffuseColor should error", (function () {
                                return _testGetFunc(LightMaterialAPI$Wonderjs.getLightMaterialDiffuseColor);
                              }));
                        return Wonder_jest.test("getLightMaterialSpecularColor should error", (function () {
                                      return _testGetFunc(LightMaterialAPI$Wonderjs.getLightMaterialSpecularColor);
                                    }));
                      }));
                return /* () */0;
              }));
        return /* () */0;
      }));

export {
  
}
/*  Not a pure module */
