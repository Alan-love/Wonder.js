<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>3d学习</title>
    <script src="../../bower_components/jquery/dist/jquery.js" type="text/javascript"></script>
    <script src="../jsExtend.js" type="text/javascript"></script>
    <script src="../Matrix.js" type="text/javascript"></script>
    <script src="../Cubic.js" type="text/javascript"></script>
    <script src="../Sprite.js" type="text/javascript"></script>
    <script src="../Buffer.js" type="text/javascript"></script>
    <script src="../FrameBuffer.js" type="text/javascript"></script>
    <script src="../Loader.js" type="text/javascript"></script>
    <script src="../Program.js" type="text/javascript"></script>
    <script src="../Shader.js" type="text/javascript"></script>
    <script src="../Webgl.js" type="text/javascript"></script>
    <script src="../Texture.js" type="text/javascript"></script>
    <script src="../Camera.js" type="text/javascript"></script>
    <script src="../Rotate.js" type="text/javascript"></script>
    <script src="specular.js" type="text/javascript"></script>
</head>
<body>
<canvas id="canvas" width="600" height="400"></canvas>

<script id="vs" type="x-shader/x-vertex">
attribute vec4 a_position;
attribute vec3 a_normal;

uniform mat4 u_mvpMatrix;
uniform mat4 u_mMatrix;
uniform mat4 u_normalMatrix;


varying vec3 v_normal;
varying vec3 v_position;
attribute vec2 a_texCoord;
varying vec2 v_texCoord;

void main(void){
    gl_Position = u_mvpMatrix * a_position;
    v_position = vec3(u_mMatrix * a_position);
    //v_normal = normalize(a_normal);
    v_normal = normalize(vec3(u_normalMatrix * vec4(a_normal, 1.0)));
    //v_normal = normalize(a_normal);
    v_texCoord = a_texCoord;
}
        </script>

<script id="fs" type="x-shader/x-fragment">
precision mediump float;

uniform sampler2D u_sampler;
varying vec2 v_texCoord;

uniform vec3 u_lightColor;
uniform vec3 u_lightDirection;
uniform vec3 u_ambientLightColor;    //环境光颜色
uniform float u_specularStrength;
uniform float u_powExponent;
uniform vec3 u_viewPos;


varying vec3 v_position;
varying vec3 v_normal;

void main(void){
    //因为内插后长度不一定为1.0
    vec3 normal = normalize(v_normal);
    vec3 lightDirection = normalize(u_lightDirection);
    float nDotL = max(dot(lightDirection, normal), 0.0);
    vec4 texColor = texture2D(u_sampler, v_texCoord);
    vec3 diffuse = u_lightColor * texColor.rgb * nDotL;
    vec3 ambient = u_ambientLightColor * texColor.rgb;

    // Specular
    //float specularStrength = 0.5f;
    vec3 viewDir = normalize(u_viewPos - v_position);
    vec3 reflectDir = reflect(-lightDirection, normal);
    float spec = pow(max(dot(viewDir, reflectDir), 0.0), u_powExponent); //pow的参数要为float类型
    vec3 specular = u_specularStrength * spec * u_lightColor * texColor.rgb;

    gl_FragColor = vec4(specular, texColor.a);
    //gl_FragColor = vec4(diffuse + ambient + specular, texColor.a);
}
</script>
</body>
</html>
