<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>3d学习</title>
    <script src="../../bower_components/jquery/dist/jquery.js" type="text/javascript"></script>
    <!--<script src="../jsExtend.js" type="text/javascript"></script>-->
    <script src="../Helper.js" type="text/javascript"></script>

    <script src="../Scene.js" type="text/javascript"></script>
    <script src="../Matrix.js" type="text/javascript"></script>
    <script src="../Cubic.js" type="text/javascript"></script>
    <script src="../Sprite.js" type="text/javascript"></script>
    <script src="../Buffer.js" type="text/javascript"></script>
    <script src="../FrameBuffer.js" type="text/javascript"></script>
    <script src="../Loader.js" type="text/javascript"></script>
    <script src="../Program.js" type="text/javascript"></script>
    <script src="../Shader.js" type="text/javascript"></script>
    <script src="../Webgl.js" type="text/javascript"></script>
    <script src="../Texture.js" type="text/javascript"></script>
    <script src="../Camera.js" type="text/javascript"></script>
    <script src="../Rotate.js" type="text/javascript"></script>
    <script src="../Translate.js" type="text/javascript"></script>
    <script src="../Light.js" type="text/javascript"></script>
    <script src="../Material.js" type="text/javascript"></script>
    <script src="multi_dynamic.js" type="text/javascript"></script>

<body>
<canvas id="canvas" width="600" height="400"></canvas>


<script id="reflect-vs" type="x-shader/x-vertex">

//todo 反射向量的计算到底是放在vs还是fs？

//todo 统一这个shader和light shader，要么都在世界坐标系中，要么都在视图坐标系中！

attribute vec4 a_position;
attribute vec4 a_normal;

uniform mat4   u_mvpMatrix;
uniform mat4   u_mMatrix;
//uniform mat4   u_mvMatrix;
uniform mat4   u_normalMatrix;
//uniform mat4   u_mInverseCamera;

// Texture coordinate to fragment program
//smooth out vec3 vVaryingTexCoord;
//varying vec3 v_texCoord;
varying vec4 v_position;
varying vec3 normalAfterModelTransform;

void main(void)
{
normalAfterModelTransform = vec3(u_normalMatrix * a_normal);

v_position = u_mMatrix * a_position;

gl_Position = u_mvpMatrix * a_position;
}
</script>


<script id="reflect-fs" type="x-shader/x-fragment">
precision mediump float;
uniform samplerCube u_sampler;
uniform vec3 u_viewPos;

varying vec4 v_position;
varying vec3 normalAfterModelTransform;

void main(void){

vec3 eyeToVertex = vec3(normalize(v_position)) - u_viewPos;

// Get reflected vector
vec3 vCoords = reflect(eyeToVertex, normalAfterModelTransform);

// Rotate by flipped camera
//convert vCoords from eye coordinate to world coordinate
//vCoords = u_mInverseCamera * vCoords;

    gl_FragColor = textureCube(u_sampler, vCoords);
}
</script>


<script id="texture2D-vs" type="x-shader/x-vertex">
attribute vec4 a_position;
uniform mat4 u_mvpMatrix;
attribute vec2 a_texCoord;
varying vec2 v_texCoord;

void main(void){
    gl_Position = u_mvpMatrix * a_position;
    v_texCoord = a_texCoord;
}
        </script>

<script id="texture2D-fs" type="x-shader/x-fragment">
precision mediump float;

uniform sampler2D u_sampler;
varying vec2 v_texCoord;

void main(void){
    gl_FragColor = texture2D(u_sampler, v_texCoord);
}
</script>

<script id="skyBox-vs" type="x-shader/x-vertex">
attribute vec4 a_position;
uniform mat4 u_mvpMatrix;
attribute vec3 a_texCoord;
varying vec3 v_texCoord;

void main(void){
    gl_Position = u_mvpMatrix * a_position;
    v_texCoord = a_texCoord;
}
        </script>

<script id="skyBox-fs" type="x-shader/x-fragment">
precision mediump float;

uniform samplerCube u_sampler;
varying vec3 v_texCoord;

void main(void){
    gl_FragColor = textureCube(u_sampler, v_texCoord);
}
</script>
</body>
</html>
