{"version":3,"file":"main.js","sources":["../lib/cuon-utils.ts","../main.ts"],"sourcesContent":["// cuon-utils.js (c) 2012 kanda and matsuda\r\n\r\n/**\r\n * Create a program object and make current\r\n * @param gl GL context\r\n * @param vshader a vertex shader program (string)\r\n * @param fshader a fragment shader program (string)\r\n * @return true, if the program object was created and successfully made current \r\n */\r\nexport function initShaders(gl, vshader, fshader) {\r\n  var program = createProgram(gl, vshader, fshader);\r\n  if (!program) {\r\n    console.log('Failed to create program');\r\n    return false;\r\n  }\r\n\r\n  gl.useProgram(program);\r\n  gl.program = program;\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * Create the linked program object\r\n * @param gl GL context\r\n * @param vshader a vertex shader program (string)\r\n * @param fshader a fragment shader program (string)\r\n * @return created program object, or null if the creation has failed\r\n */\r\nfunction createProgram(gl, vshader, fshader) {\r\n  // Create shader object\r\n  var vertexShader = loadShader(gl, gl.VERTEX_SHADER, vshader);\r\n  var fragmentShader = loadShader(gl, gl.FRAGMENT_SHADER, fshader);\r\n  if (!vertexShader || !fragmentShader) {\r\n    return null;\r\n  }\r\n\r\n  // Create a program object\r\n  var program = gl.createProgram();\r\n  if (!program) {\r\n    return null;\r\n  }\r\n\r\n  // Attach the shader objects\r\n  gl.attachShader(program, vertexShader);\r\n  gl.attachShader(program, fragmentShader);\r\n\r\n  // Link the program object\r\n  gl.linkProgram(program);\r\n\r\n  // Check the result of linking\r\n  var linked = gl.getProgramParameter(program, gl.LINK_STATUS);\r\n  if (!linked) {\r\n    var error = gl.getProgramInfoLog(program);\r\n    console.log('Failed to link program: ' + error);\r\n    gl.deleteProgram(program);\r\n    gl.deleteShader(fragmentShader);\r\n    gl.deleteShader(vertexShader);\r\n    return null;\r\n  }\r\n  return program;\r\n}\r\n\r\n/**\r\n * Create a shader object\r\n * @param gl GL context\r\n * @param type the type of the shader object to be created\r\n * @param source shader program (string)\r\n * @return created shader object, or null if the creation has failed.\r\n */\r\nfunction loadShader(gl, type, source) {\r\n  // Create shader object\r\n  var shader = gl.createShader(type);\r\n  if (shader == null) {\r\n    console.log('unable to create shader');\r\n    return null;\r\n  }\r\n\r\n  // Set the shader program\r\n  gl.shaderSource(shader, source);\r\n\r\n  // Compile the shader\r\n  gl.compileShader(shader);\r\n\r\n  // Check the result of compilation\r\n  var compiled = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n  if (!compiled) {\r\n    var error = gl.getShaderInfoLog(shader);\r\n    console.log('Failed to compile shader: ' + error);\r\n    gl.deleteShader(shader);\r\n    return null;\r\n  }\r\n\r\n  return shader;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * Initialize and get the rendering for WebGL\r\n * @param canvas <cavnas> element\r\n * @param opt_debug flag to initialize the context for debugging\r\n * @return the rendering context for WebGL\r\n */\r\nexport function getWebGLContext(canvas) {\r\n  // Get the rendering context for WebGL\r\n  var gl = setupWebGL(canvas);\r\n\r\n  if (!gl) return null;\r\n\r\n  // // if opt_debug is explicitly false, create the context for debugging\r\n  // if (arguments.length < 2 || opt_debug) {\r\n  //     gl = WebGLDebugUtils.makeDebugContext(gl);\r\n  // }\r\n\r\n  return gl;\r\n}\r\n\r\n\r\n/**\r\n * Creates a webgl context. If creation fails it will\r\n * change the contents of the container of the <canvas>\r\n * tag to an error message with the correct links for WebGL.\r\n * @param {Element} canvas. The canvas element to create a\r\n *     context from.\r\n * @param {WebGLContextCreationAttirbutes} opt_attribs Any\r\n *     creation attributes you want to pass in.\r\n * @param {function:(msg)} opt_onError An function to call\r\n *     if there is an error during creation.\r\n * @return {WebGLRenderingContext} The created context.\r\n */\r\nvar setupWebGL = function(canvas) {\r\n  // function handleCreationError(msg) {\r\n  //     var container = document.getElementsByTagName(\"body\")[0];\r\n  //     //var container = canvas.parentNode;\r\n  //     if (container) {\r\n  //         var str = window.WebGLRenderingContext ?\r\n  //             OTHER_PROBLEM :\r\n  //             GET_A_WEBGL_BROWSER;\r\n  //         if (msg) {\r\n  //             str += \"<br/><br/>Status: \" + msg;\r\n  //         }\r\n  //         container.innerHTML = makeFailHTML(str);\r\n  //     }\r\n  // };\r\n  //\r\n  // opt_onError = opt_onError || handleCreationError;\r\n\r\n  if (canvas.addEventListener) {\r\n    canvas.addEventListener(\"webglcontextcreationerror\", function(event) {\r\n      throw new Error(event.statusMessage);\r\n    }, false);\r\n  }\r\n\r\n  var context = create3DContext(canvas);\r\n  // if (!context) {\r\n  //     if (!window.WebGLRenderingContext) {\r\n  //         opt_onError(\"\");\r\n  //     } else {\r\n  //         opt_onError(\"\");\r\n  //     }\r\n  // }\r\n\r\n  if(!context){\r\n    throw new Error(\"error\");\r\n  }\r\n\r\n  return context;\r\n};\r\n\r\n\r\n/**\r\n * Creates a webgl context.\r\n * @param {!Canvas} canvas The canvas tag to get context\r\n *     from. If one is not passed in one will be created.\r\n * @return {!WebGLContext} The created context.\r\n */\r\nvar create3DContext = function(canvas) {\r\n  var names = [\"webgl\", \"experimental-webgl\", \"webkit-3d\", \"moz-webgl\"];\r\n  var context = null;\r\n  for (var ii = 0; ii < names.length; ++ii) {\r\n    try {\r\n      context = canvas.getContext(names[ii]);\r\n    } catch(e) {}\r\n    if (context) {\r\n      break;\r\n    }\r\n  }\r\n  return context;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n","import {getWebGLContext, initShaders} from \"./lib/cuon-utils\";\n\nvar VSHADER_SOURCE =\n    'attribute vec4 a_Position;\\n' +\n    'void main() {\\n' +\n    '  gl_Position = a_Position;\\n' +\n    '}\\n';\n\n// Fragment shader program\nvar FSHADER_SOURCE =\n    'void main() {\\n' +\n    '  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\\n' +\n    '}\\n';\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nexport var main = () => {\n    // Retrieve <canvas> element\n    var canvas = document.getElementById('webgl');\n\n    // Get the rendering context for WebGL\n    var gl = getWebGLContext(canvas);\n    if (!gl) {\n        console.log('Failed to get the rendering context for WebGL');\n        return;\n    }\n\n    // Initialize shaders\n    if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) {\n        console.log('Failed to intialize shaders.');\n        return;\n    }\n\n    // Write the positions of vertices to a vertex shader\n    var n = initVertexBuffers(gl);\n    if (n < 0) {\n        console.log('Failed to set the positions of the vertices');\n        return;\n    }\n\n    // Specify the color for clearing <canvas>\n    gl.clearColor(0, 0, 0, 1);\n\n    // Clear <canvas>\n    gl.clear(gl.COLOR_BUFFER_BIT);\n\n    // Draw the rectangle\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, n);\n}\n\nfunction initVertexBuffers(gl) {\n    var vertices = new Float32Array([\n        -0.5, 0.5,   -0.5, -0.5,   0.5, 0.5,ã€€0.5, -0.5\n    ]);\n    var n = 4; // The number of vertices\n\n    // Create a buffer object\n    var vertexBuffer = gl.createBuffer();\n    if (!vertexBuffer) {\n        console.log('Failed to create the buffer object');\n        return -1;\n    }\n\n    // Bind the buffer object to target\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\n    // Write date into the buffer object\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\n\n    var a_Position = gl.getAttribLocation(gl.program, 'a_Position');\n    if (a_Position < 0) {\n        console.log('Failed to get the storage location of a_Position');\n        return -1;\n    }\n    // Assign the buffer object to a_Position variable\n    gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 0, 0);\n\n    // Enable the assignment to a_Position variable\n    gl.enableVertexAttribArray(a_Position);\n\n    return n;\n}\n"],"names":[],"mappings":"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"}